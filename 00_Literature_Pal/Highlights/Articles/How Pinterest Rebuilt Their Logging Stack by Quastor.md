---
title: How Pinterest Rebuilt Their Logging Stack
full Title: How Pinterest Rebuilt Their Logging Stack
author: Quastor
URL: 
published date: 2024-04-09
category: articles
source: reader
tags: [medium/articles, author/Quastor, reader/reader, date/2024-04-14, area/reader]
created: 2024-04-14
assignedTo: people/pal
priority: P4
work: document
---
author:: [[Quastor]]
note:: 
source:: [[reader]]
url:: 
image_url:: [articles image URL](https://readwise-assets.s3.amazonaws.com/static/images/article3.5c705a01b476.png)
category:: [[articles]]
date:: [[2024-04-14]]
last_highlighted_date:: [[2024-04-14]]
published_date:: [[2024-04-09]]
summary:: Pinterest revamped their logging system to enhance observability by utilizing key-value pairs for flexibility and real-time visualization through OpenSearch. The new architecture involves storing data in Kafka, processing with Logstash, and integrating with AWS OpenSearch for analytics. The updated system allows developers to gain insights on app performance and codebase visibility, fostering better monitoring and alerting capabilities.


![rw-book-cover](https://readwise-assets.s3.amazonaws.com/static/images/article3.5c705a01b476.png)

## Highlights
### id706837552
[[2024-04-14]] 14:35
> Logs are time stamped records of discrete events/messages that are generated by the various applications, services and components in your system.
> They’re meant to provide a *qualitative* view of the backend’s behavior and can typically be split into
> • **Application Logs** - Messages logged by your server code, databases, etc.
> • **System Logs** - Generated by systems-level components like the operating system, disk errors, hardware devices, etc.
> • **Network Logs** - Generated by routers, load balancers, firewalls, etc. They provide information about network activity like packet drops, connection status, traffic flow and more.
> Logs are commonly in plaintext, but they can also be in a structured format like JSON. They’ll be stored in a database like Elasticsearch
> The issue with just using logs is that they can be extremely noisy and it’s hard to extrapolate any higher-level meaning of the state of your system out of the logs.
> Incorporating metrics into your toolkit helps you solve this.


### id706837722
[[2024-04-14]] 14:38
> Metrics provide a *quantitative* view of your backend around factors like response times, error rates, throughput, resource utilization and more. They’re commonly stored in a time series database.
> They’re amenable to statistical modeling and prediction. Calculating averages, percentiles, correlation and more with metrics make them particularly useful for understanding the behavior of your system over some period of time.
> The shortcoming of both metrics and logs is that they’re scoped to an individual component/system. If you want to figure out what happened across your entire system during the lifetime of a request that traversed multiple services/components, you’ll have to do some additional work (joining together logs/metrics from multiple components).
> This is where Distributed Tracing comes in.


### id706837911
[[2024-04-14]] 14:39
> **Tracing**
> Distributed traces allow you to track and understand how a single request flows through multiple components/services in your system.
> To implement this, you identify specific points in your backend where you have some fork in execution flow or a hop across network/process boundaries. This can be a call to another microservice, a database query, a cache lookup, etc.
> Then, you assign each request that comes into your system a [UUID](https://link.mail.beehiiv.com/ss/c/u001.GaP25kixWOTuE1E3XPYxBYaNyUGZyVKJhuXIbGlJOOLUJIjV6ub92uyIcESFk25X3CVMHQgJXdifMJDkeKSOdYowqyZ0Zgk3zIa1HFpx1G7xN-jA_F1KvLz80eHipQTEJ4tHl5iVFSrkYyvNnAJem-JtrdOM4PbRnZsVpQP9l50PaS5WUU3GmaX4Qfz2IaDJzDBiUBqrhF71Jp2_3vxBcrrtS5k6y3nZSSFYmvvZxWQ/45d/PALeBuGFS9KF_JDdR1nunQ/h12/h001.4K-W_igY7Sjf6-noOnmKRQrzZayuHUgsz-D6rztSJ3c) (unique ID) so you can keep track of it. You add instrumentation to each of these specific points in your backend so you can track when the request enters/leaves (the OpenTelemetry project calls this [Context Propagation](https://link.mail.beehiiv.com/ss/c/u001.D0tvvj5znpCmCaUIlCn_q5dksXDp_lvtRnMiIrjTSFaXaE4TQOVpZ61a4vlhF7hUyigrIGfWWYNhdF-Z4rvwHV_mEfQwsMLLBe9U_0em8Y_EkT7G-ilZLrHMfa8omJ2OtGT7G84gfBgPVDjGfDj8EX-R9We6RZBY9ni1Q44RvJkiDSBoiEoXzWXeQIszljKEdbzqtJz0lzwNZFaXKmfBJZ0DnomOdScqwlQeHq9qzE8/45d/PALeBuGFS9KF_JDdR1nunQ/h13/h001.dEfvk0myqKOgaKZphxcTOTzAxUtSyouHEL6k-VAeUxY)).
> You can analyze this data with an open source system like Jaeger or Zipkin.
> If you’d like to learn more about implementing Traces, you can read about how DoorDash used OpenTelemetry [here](https://link.mail.beehiiv.com/ss/c/u001.LUZYrxblx92g0_IcD8eBHeJtYbs4ot4RMUOF7cLoZ2AZCkb92022WdMGaqH8_GwN6xoBjnDJ0GLYL9fo4jcZLuqNBEYX2syAcsl9M7puNKpW_Gx3h-Afrp-O_-m_TZOst0VLkrZY0iIpSMSSqr-SHZp1ROGLF3olxs04uFzlQX57FKnMNfai9Oz7uOEnu64KG0QnQGJvoi0QVpw4CYoPqcvlIqQ4dgYFRx50AnQz1U5j1ZGD7qNaaRUwBGahSbm0HTzOmc16BMR9FfTN8_vRPvPaXz_r3P_3UeEsky5Bs5g/45d/PALeBuGFS9KF_JDdR1nunQ/h14/h001.5Gt0MwT2lDa5RIox1tdU1ddkecnx4aKU6Mgbh3bUeso).


### id706838474
[[2024-04-14]] 14:41
> **Real Time** - They made it easy to set up real-time alerting with custom metrics based on the logs

- [n] Interesting to note, you can create custom metrics from logs  * [View Highlight](https://read.readwise.io/read/01hvf228p7881828syz044j26t)


## New highlights added April 15, 2024 at 8:42 PM
### id707258282
[[2024-04-15]] 16:44
> **Logging at Pinterest**
> Building out each part of your Observability stack can be a challenge, especially if you’re working at a massive scale.
> Pinterest published a [blog post](https://link.mail.beehiiv.com/ss/c/u001.QjwHEd_jinjS0_NVgYI6PyoV0Qx1eJdryem9QXPLhc6lkf1JgxSqgQy-7CWpEcJnL71Pw12Dc88JtYupY7ZUjjY9a_SW-1_MhHocn3ijJn4CPzjwSiiVNJP6E0ddadUllB9uSIIukzCmuIz3qIRYR6xuUTquWjtPfO1OrjQtOxD4CE2OokrXjsoXvIP1EaWk4tO2luBejlRUV-6_3Vbr8GVXRZEPo0PKiaHxDeD22LS2y_wqAgIDJJdjgY2kHoLpldosRdpeVx86oABxw_PHxA-SOfeGs3u1g6mRnWsYWpA/45d/PALeBuGFS9KF_JDdR1nunQ/h15/h001.fIO45Wpi0NC5GkNJfjxFThUXLdrY5LMLW1Mrk6sdUYM) delving into how their Logging System works.
> *Here’s a summary*
> In 2020, Pinterest had a critical incident with their iOS app that spiked the number of out-of-memory crashes users were experiencing. While debugging this, they realized they didn’t have enough visibility into how the app was running nor a good system for monitoring and troubleshooting.
> They decided to overhaul their logging system and create an end-to-end pipeline with the following characteristics
> • **Flexibility** - the logging payload will just be key-value pairs, so it’s flexible and easy to use.
> • **Easy to Query and Visualize** - It’s integrated with OpenSearch (Amazon’s fork of Elasticsearch and Kibana) for real time visualization and querying.
> • **Real Time** - They made it easy to set up real-time alerting with custom metrics based on the logs.
> Here’s the architecture
> ![](https://media.beehiiv.com/cdn-cgi/image/fit=scale-down,format=auto,onerror=redirect,quality=80/uploads/asset/file/1839bc75-effb-4b1c-88a3-05f85a396fbc/Screenshot_2024-04-09_at_2.29.03_PM.png?t=1712687350)
> The logging payload is key-value pairs sent to Pinterest’s Logservice. The JSON messages are passed to [Singer](https://link.mail.beehiiv.com/ss/c/u001.sukw43JK3wCGk5mFUJJ2vINEFV18Yet3_6SsR89bdKyRoN3_cgelmh44_uiLVCb3FNmpsecsxh-dcCgI4ZmMeIT8_AQzmWAvseKprf0YaOXpNv0otMwgbdVrGJWN2kfGNblnUZMAGESJohx7DxP0DX9n-THAGLa2WoycaxcqSyQ7Gjo3978RO1WiDTtloI6WRoImwDlGDVk1DMSxA5cg9A/45d/PALeBuGFS9KF_JDdR1nunQ/h16/h001.IuKkWt4bZ6cUp7zjYqlT4p_k9Dq0KfYdtT8DqS5LgYU), a logging agent that Pinterest built for uploading data to Kafka (it can be extended to support other storage systems).
> They’re stored in a Kafka topic and a variety of analytics services at Pinterest can subscribe to consume the data.
> Pinterest built a data persisting service called Merced to move data from Kafka to AWS S3. From there, developers can write SQL queries to access that data using [Apache Hive](https://link.mail.beehiiv.com/ss/c/u001.GaP25kixWOTuE1E3XPYxBYaNyUGZyVKJhuXIbGlJOOLFh-oABfJQigvNacxbs3sAbABpb4uivmGWsmqANVbshJ6DdIoNDslXwBO-KKxqlFxlGnCgqmphiCsDFrIQrteJPsn93SQ0d2um8GBaIPrcscqvv4FMaTyGA38oFdu0DSACASGu1tUEAkYetmYy7P5Bz0Ku-zTXjzOLhrpZxLAm8w/45d/PALeBuGFS9KF_JDdR1nunQ/h17/h001.rWSzULNozC-GV4C7UUceWc-lbARn9aI4RtbadR4Tei8) (a data warehouse tool that lets you write SQL queries to access data you store on a data lake like S3 or HDFS).
> Logstash also ingests data from Kafka and sends it to AWS OpenSearch, Amazon’s offering for the [ELK stack](https://link.mail.beehiiv.com/ss/c/u001.BZLbP9XJ2QJxuYXp69zcq55t5DAygTZFeHiPIoHb-Vt5kmpl3h_ZCQtw3IQSudPZr4-cLkb-S3uVSEAVplySbIh_Debg0q7xAHKUueiLVYe8rrlRXlVGd9ZKcqXZHMWFETOvQY4rY_z2pPhkyxkDEH6JXS6NVvb5wrOnHJHAo7l1RufWAJGGNjZVpSxT5eXCp_FQpH91Gz2RNFc1d58sBg/45d/PALeBuGFS9KF_JDdR1nunQ/h18/h001.fYOzhuF3C3RELRjxxg3qR8YltIi5bgxJGAU-C2JDDZA).
> Pinterest developers now use this pipeline for
> • **Client Visibility** - Get insights on app performance with metrics around networking, crashes and more.
> • **Developer Logs** - Gain visibility on the codebase and measure things like how often a certain code path is run in the app. Also, it helps troubleshoot odd bugs that are hard to reproduce locally.
> • **Real Time Alerting** - Real time alerting if there’s any issues with certain products/features in the app.
> And more.
> [](https://link.mail.beehiiv.com/ss/c/u001.8dFPyTsecDoXHzJV_U5eqs8QOK8US9CRyswX2uCjsgCrV-fMBf6UqXQJx7_ptMq-2SM3Sz1sVZy3zUxqKIieoi_-7EAV6iFlovyTfSiXknIguVuiIw7gfM4LSCgQ9_2-EHLqxxqUqbZmhL7I2hbnjR2GBfFPSUW0Wmrom2aO-Unb86jwB5EpLwCULJPNjj6ekG52EahxMLnsZWi1abPm7I1Q5yDJRGUNYMkof59WZDz8Pqr2P8Vc-McYskrfFBR9au_pFw9_4CLi9fnlFiSjvz9o6JMYNWgzu3KiA-znzmmNu1ZZgsm6efEBA2NvCfea/45d/PALeBuGFS9KF_JDdR1nunQ/h19/h001.ioAdkyt87bMJY_3m4odLn2FidKa_nGOSw-9psieDK_g)


